<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5 Card Draw Poker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1e293b;
            color: white;
            overflow: hidden;
        }

        #debug {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            padding: 5px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
        }

        .game-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .game-header {
            background-color: #0f2937;
            color: #f8c471;
            padding: 10px;
            text-align: center;
            font-size: 20px;
            border-bottom: 2px solid #713f12;
        }

        .table-area {
            flex: 1;
            position: relative;
            margin: 20px;
            background-color: #15803d;
            border-radius: 50%;
            border: 10px solid #713f12;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
        }

        .table-center {
            text-align: center;
        }

        .pot {
            font-size: 22px;
            font-weight: bold;
            color: #fcd34d;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px #000;
        }

        .player-positions {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .player-spot {
            position: absolute;
            width: 120px;
            padding: 8px;
            background-color: rgba(0,0,0,0.6);
            border-radius: 5px;
            text-align: center;
        }

        /* Player positions around the table */
        .player-spot:nth-child(1), 
        .player-spot:nth-child(2), 
        .player-spot:nth-child(3), 
        .player-spot:nth-child(4), 
        .player-spot:nth-child(5), 
        .player-spot:nth-child(6) {
            position: absolute;
        }
        
        .player-spot {
            position: absolute;
            width: 120px;
            padding: 8px;
            background-color: rgba(0,0,0,0.6);
            border-radius: 5px;
            text-align: center;
        }
        
        .current-player {
            background-color: rgba(0,0,0,0.8);
            border: 2px solid #f8c471;
        }

        .player-name {
            font-weight: bold;
            color: #f8c471;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .player-chips {
            font-size: 14px;
            color: #bdc3c7;
        }

        .player-cards {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 5px;
        }

        .card {
            width: 35px;
            height: 50px;
            background-color: white;
            border-radius: 3px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: black;
            font-weight: bold;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        .card.facedown {
            background: linear-gradient(135deg, #1e40af 25%, #1e3a8a 25%, #1e3a8a 50%, #1e40af 50%, #1e40af 75%, #1e3a8a 75%);
            background-size: 20px 20px;
            color: transparent;
        }

        .game-status {
            position: absolute;
            bottom: 15px;
            left: 15px;
            padding: 8px 12px;
            background-color: rgba(0,0,0,0.7);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="debug">Loading 5 Card Draw...</div>
    
    <div class="game-container">
        <div class="game-header">5 Card Draw Poker</div>
        
        <div class="table-area">
            <div class="table-center">
                <div class="pot">Pot: $0</div>
            </div>
            
            <div class="player-positions" id="playerPositions">
                <!-- Player spots will be generated here -->
            </div>
            
            <div class="game-status" id="gameStatus">
                Waiting for players...
            </div>
        </div>
    </div>

    <script>
        // Debug element for troubleshooting
        const debug = document.getElementById('debug');
        const logDebug = (msg) => {
            console.log(msg);
            debug.textContent = msg;
            setTimeout(() => debug.textContent = '', 5000);
        };
        
        logDebug('Game frame loaded');
        
        // Game elements
        const playerPositions = document.getElementById('playerPositions');
        const gameStatus = document.getElementById('gameStatus');
        
        // Listen for messages from parent frame
        window.addEventListener('message', function(event) {
            logDebug('Received message: ' + event.data.type);
            
            if (event.data.type === 'command') {
                if (event.data.command === 'updatePlayers') {
                    updatePlayers(event.data.data.players);
                }
                
                if (event.data.command === 'startGame') {
                    startGame(event.data.data);
                }
            }
        });
        
        // Update player information
        function updatePlayers(players) {
            // Add safety check to handle undefined players
            if (!players) {
                logDebug('Warning: players data is undefined');
                playerPositions.innerHTML = '';
                return;
            }
            
            logDebug(`Updating ${players.length} players`);
            
            // Clear existing players
            playerPositions.innerHTML = '';
            
            if (players.length === 0) return;
            
            // Assume first player is the current player (or could be determined by a property)
            const currentPlayer = players[0];
            const otherPlayers = players.slice(1);
            
            // Create and position current player at bottom
            const currentPlayerSpot = createPlayerSpot(currentPlayer, 'bottom');
            currentPlayerSpot.classList.add('current-player');
            playerPositions.appendChild(currentPlayerSpot);
            
            // Position other players evenly around the top semicircle
            if (otherPlayers.length > 0) {
                const angleStep = 180 / (otherPlayers.length + 1);
                
                otherPlayers.forEach((player, index) => {
                    // Calculate position (index + 1 to avoid placing at 0 degrees)
                    const angle = (index + 1) * angleStep;
                    const playerSpot = createPlayerSpot(player, angle);
                    playerPositions.appendChild(playerSpot);
                });
            }
        }

        // Create a player spot with calculated position
        function createPlayerSpot(player, position) {
            const playerSpot = document.createElement('div');
            playerSpot.className = 'player-spot';
            
            playerSpot.innerHTML = `
                <div class="player-name">${player.name}</div>
                <div class="player-chips">$${player.chips || player.wallet || 1000}</div>
                <div class="player-cards">
                    <div class="card facedown">?</div>
                    <div class="card facedown">?</div>
                </div>
            `;
            
            // Position the player spot
            if (position === 'bottom') {
                // Current player at bottom
                playerSpot.style.bottom = '10px';
                playerSpot.style.left = '50%';
                playerSpot.style.transform = 'translateX(-50%)';
            } else {
                // Position around the semicircle based on angle
                const angle = position; // angle in degrees
                const radius = 40; // % of container
                
                const radians = angle * (Math.PI / 180);
                const x = 50 + radius * Math.cos(radians); // center x + radius * cos(angle)
                const y = 50 - radius * Math.sin(radians); // center y - radius * sin(angle)
                
                playerSpot.style.left = `${x}%`;
                playerSpot.style.top = `${y}%`;
                playerSpot.style.transform = 'translate(-50%, -50%)';
            }
            
            return playerSpot;
        }
        
        // Start the game
        function startGame(data) {
            logDebug('Starting game: ' + (data?.gameType || 'unknown'));
            gameStatus.textContent = 'Game in progress...';
            
            // Add safety check before calling updatePlayers
            if (data && data.players) {
                updatePlayers(data.players);
            } else {
                logDebug('Warning: No player data available for game start');
                // Use empty array as fallback to clear the table
                updatePlayers([]);
            }
        }
        
        // Initialize when the page loads
        window.onload = function() {
            logDebug('Five Card Draw interface initialized');
            
            // Let the parent frame know we're ready
            window.parent.postMessage({
                type: 'gameFrameReady',
                gameType: '5 Card Draw'
            }, '*');
        };
    </script>
</body>
</html>